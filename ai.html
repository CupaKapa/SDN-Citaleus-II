<div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; text-align: left;">
    <header style="background-color: #f5f5f5; color: #333; padding: 10px; border-radius: 8px 8px 0 0; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <h1 style="margin: 0; font-size: 1.4rem;">SDN Citaleus 2</h1>
    </header>
  
    <div id="chatContainerEl" style="height: 400px; border: 1px solid #ddd; overflow-y: auto; padding: 10px; background-color: #f9f9f9;"></div>
    
    <div style="display: flex; margin-top: 10px;">
      <input type="text" id="userInputEl" placeholder="Ketik pesan Anda di sini..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" onkeypress="if(event.key === 'Enter') sendMessage()">
      <button id="sendBtn" onclick="sendMessage()" style="margin-left: 10px; padding: 10px 20px; background-color: #607d8b; color: white; border: none; border-radius: 4px; cursor: pointer;">Kirim</button>
    </div>
  </div>
  
  <script>
    // Informasi dasar tentang SDN Citaleus 2 untuk konteks bot
    const schoolInfo = `
      SDN Citaleus 2 adalah sekolah dasar negeri yang berlokasi di daerah Citaleus.
      Alamat: Jl. Citaleus No. 2, Kecamatan Citaleus, Kabupaten/Kota [Nama Kabupaten/Kota].
      Visi: Menjadikan siswa berprestasi, berkarakter, dan berbudi pekerti luhur.
      Misi: Memberikan pendidikan berkualitas, membangun karakter siswa, dan menciptakan lingkungan belajar yang nyaman.
      Fasilitas: Perpustakaan, Laboratorium Komputer, Lapangan Olahraga, UKS, Kantin Sehat, dan Mushola.
      Ekstrakurikuler: Pramuka, Drumband, Pencak Silat, Menari Tradisional, dan Kesenian.
      Prestasi: Juara Lomba Kebersihan Tingkat Kecamatan, Juara Lomba Cerdas Cermat, dan berbagai prestasi di bidang olahraga.
    `;
    
    // Inisialisasi chat dengan pesan pembuka dari bot
    window.onload = function() {
      addBotMessage("Selamat datang di Chat Bot SDN Citaleus 2! Ada yang bisa saya bantu tentang sekolah kami?");
    };
    
    // Fungsi untuk menambahkan pesan pengguna ke chat
    function addUserMessage(message) {
      const chatContainer = chatContainerEl;
      const messageElement = document.createElement('div');
      messageElement.style.textAlign = 'right';
      messageElement.style.margin = '10px 0';
      messageElement.innerHTML = `
        <span style="background-color: #e6eef2; padding: 8px 12px; border-radius: 15px; display: inline-block; max-width: 80%;">
          ${message}
        </span>
      `;
      chatContainer.appendChild(messageElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Fungsi untuk menambahkan pesan bot ke chat
    function addBotMessage(message) {
      const chatContainer = chatContainerEl;
      const messageElement = document.createElement('div');
      messageElement.style.textAlign = 'left';
      messageElement.style.margin = '10px 0';
      messageElement.innerHTML = `
        <div>
          <div style="font-weight: bold; font-size: 0.85rem; color: #555; margin-left: 5px; margin-bottom: 3px;">
            Bot
          </div>
          <span style="background-color: #f0f0f0; padding: 8px 12px; border-radius: 15px; display: inline-block; max-width: 80%;">
            ${message}
          </span>
        </div>
      `;
      chatContainer.appendChild(messageElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Fungsi untuk menampilkan indikator mengetik
    function showTypingIndicator() {
      const chatContainer = chatContainerEl;
      const indicatorElement = document.createElement('div');
      indicatorElement.id = 'typingIndicatorEl';
      indicatorElement.style.textAlign = 'left';
      indicatorElement.style.margin = '10px 0';
      indicatorElement.innerHTML = `
        <div>
          <div style="font-weight: bold; font-size: 0.85rem; color: #555; margin-left: 5px; margin-bottom: 3px;">
            Bot
          </div>
          <div style="color: #777; font-style: italic; font-size: 0.85rem; margin-left: 5px;">
            sedang mengetik...
          </div>
        </div>
      `;
      chatContainer.appendChild(indicatorElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Fungsi untuk menghapus indikator mengetik
    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicatorEl');
      if (indicator) {
        indicator.remove();
      }
    }
    
    // Variabel untuk menyimpan seluruh riwayat chat
    let chatHistory = [];
    
    // Fungsi untuk mengirim pesan dan mendapatkan respons
    async function sendMessage() {
      const userInput = userInputEl;
      const message = userInput.value.trim();
      
      if (message === '') return;
      
      // Tambahkan pesan pengguna ke chat
      addUserMessage(message);
      chatHistory.push(`Pengguna: ${message}`);
      
      // Kosongkan input
      userInput.value = '';
      
      // Tampilkan indikator mengetik
      showTypingIndicator();
      document.getElementById('sendBtn').disabled = true;
      
      try {
        // Siapkan prompt untuk AI dengan informasi sekolah dan riwayat chat
        const prompt = `
          Kamu adalah chatbot resmi SDN Citaleus 2, sebuah sekolah dasar di Indonesia.
          Tugas kamu adalah memberikan informasi akurat dan cepat tentang sekolah.
          Berikut ini beberapa informasi dasar tentang sekolah:
          ${schoolInfo}
          
          Berikut adalah riwayat chat:
          ${chatHistory.join('\n')}
          
          Berikan respons yang ramah, informatif, dan akurat dalam Bahasa Indonesia.
          Jika ditanya tentang informasi yang tidak ada dalam data di atas, berikan jawaban umum yang masuk akal untuk sebuah sekolah dasar negeri di Indonesia.
          Jika ditanya hal di luar konteks sekolah, tetap sopan dan arahkan percakapan kembali ke topik SDN Citaleus 2.
          Jawaban harus singkat dan padat.
        `;
        
        // Dapatkan respons dari AI
        const botResponse = await generateText(prompt);
        
        // Bersihkan format respons untuk mengambil hanya bagian yang relevan
        let cleanResponse = botResponse.trim();
        if (cleanResponse.startsWith('Bot:')) {
          cleanResponse = cleanResponse.substring(4).trim();
        } else if (cleanResponse.startsWith('Chatbot:')) {
          cleanResponse = cleanResponse.substring(8).trim();
        }
        
        // Hapus indikator mengetik
        removeTypingIndicator();
        
        // Tambahkan respons bot ke chat
        addBotMessage(cleanResponse);
        chatHistory.push(`Bot: ${cleanResponse}`);
        
      } catch (error) {
        console.error('Error:', error);
        // Hapus indikator mengetik
        removeTypingIndicator();
        addBotMessage('Maaf, terjadi kesalahan. Silakan coba lagi.');
      } finally {
        // Aktifkan kembali tombol kirim
        document.getElementById('sendBtn').disabled = false;
      }
    }
  </script>
  
  <style>
    /* Responsive design for mobile devices */
    @media (max-width: 600px) {
      div[style*="max-width: 600px"] {
        width: 95% !important;
        max-width: 95% !important;
        padding: 0 8px !important;
      }
      
      header {
        padding: 8px !important;
      }
      
      header h1 {
        font-size: 1.2rem !important;
      }
      
      #chatContainerEl {
        height: 60vh !important; 
      }
      
      #sendBtn {
        padding: 8px 12px !important;
        font-size: 0.9rem !important;
      }
      
      #userInputEl {
        font-size: 0.9rem !important;
        padding: 8px !important;
      }
    }
  </style>